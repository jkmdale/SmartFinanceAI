<!DOCTYPE html>
<html lang="en" dir="ltr" class="theme-dark">
<head>
    <!-- ===== BASIC META TAGS ===== -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    
    <!-- ===== SECURITY HEADERS ===== -->
    <meta http-equiv="Content-Security-Policy" content="
        default-src 'self';
        script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdnjs.cloudflare.com;
        style-src 'self' 'unsafe-inline' https://fonts.googleapis.com;
        font-src 'self' https://fonts.gstatic.com;
        img-src 'self' data: blob: https:;
        connect-src 'self' https://api.exchangerate-api.com https://api.openai.com wss:;
        worker-src 'self' blob:;
        frame-src 'none';
        object-src 'none';
        base-uri 'self';">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="X-Frame-Options" content="DENY">
    <meta http-equiv="X-XSS-Protection" content="1; mode=block">
    <meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin">
    <meta http-equiv="Permissions-Policy" content="
        camera=(),
        microphone=(),
        geolocation=(self),
        payment=(self),
        publickey-credentials-get=(self)">
    
    <!-- ===== PRIMARY META INFORMATION ===== -->
    <title>SmartFinanceAI - Global Personal Finance Operating System</title>
    <meta name="description" content="Intelligent money management with AI coaching, multi-country support, and collaborative features for individuals, couples, and families worldwide. Transform how you manage money through intelligent automation.">
    <meta name="keywords" content="personal finance, budgeting, AI financial coach, multi-currency, banking, investment tracking, global finance management, SaaS">
    <meta name="author" content="SmartFinanceAI">
    <meta name="robots" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1">
    <meta name="language" content="English">
    <meta name="revisit-after" content="7 days">
    <meta name="rating" content="general">
    
    <!-- ===== PWA MANIFEST & APP CONFIGURATION ===== -->
    <link rel="manifest" href="/manifest.json">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="SmartFinanceAI">
    <meta name="application-name" content="SmartFinanceAI">
    <meta name="msapplication-TileColor" content="#1e1b4b">
    <meta name="msapplication-config" content="/browserconfig.xml">
    <meta name="theme-color" content="#8b5cf6" id="theme-color-meta">
    <meta name="color-scheme" content="dark light">
    
    <!-- ===== ICONS & BRANDING ===== -->
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="icon" type="image/png" sizes="16x16" href="/icons/icon-16x16.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/icons/icon-32x32.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/icons/icon-152x152.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/icons/icon-120x120.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/icons/icon-114x114.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/icons/icon-76x76.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/icons/icon-60x60.png">
    <link rel="apple-touch-icon" sizes="57x57" href="/icons/icon-57x57.png">
    
    <!-- ===== SOCIAL MEDIA META TAGS (OPEN GRAPH) ===== -->
    <meta property="og:title" content="SmartFinanceAI - Global Personal Finance Operating System">
    <meta property="og:description" content="Intelligent money management with AI coaching, multi-country support, and collaborative features. Transform how you manage money through intelligent automation.">
    <meta property="og:image" content="https://smartfinanceai.com/images/social-share.png">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:image:alt" content="SmartFinanceAI Dashboard Preview">
    <meta property="og:url" content="https://smartfinanceai.com">
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="SmartFinanceAI">
    <meta property="og:locale" content="en_US">
    
    <!-- ===== TWITTER CARD META TAGS ===== -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@SmartFinanceAI">
    <meta name="twitter:creator" content="@SmartFinanceAI">
    <meta name="twitter:title" content="SmartFinanceAI - Global Personal Finance Operating System">
    <meta name="twitter:description" content="Intelligent money management with AI coaching, multi-country support, and collaborative features for individuals, couples, and families worldwide.">
    <meta name="twitter:image" content="https://smartfinanceai.com/images/twitter-card.png">
    <meta name="twitter:image:alt" content="SmartFinanceAI App Interface">
    
    <!-- ===== FINANCIAL APP SPECIFIC META TAGS ===== -->
    <meta name="financial-app-type" content="personal-finance-manager">
    <meta name="supported-currencies" content="USD,EUR,GBP,AUD,CAD,NZD,JPY">
    <meta name="supported-countries" content="US,UK,AU,CA,NZ">
    <meta name="security-features" content="end-to-end-encryption,biometric-auth,zero-knowledge">
    <meta name="privacy-compliant" content="GDPR,CCPA,PCI-DSS">
    
    <!-- ===== PERFORMANCE & PRELOADING ===== -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://api.exchangerate-api.com">
    <link rel="dns-prefetch" href="https://cdnjs.cloudflare.com">
    <link rel="preload" href="/src/styles/main.css" as="style">
    <link rel="preload" href="/src/utils/app-shell.js" as="script">
    <link rel="preload" href="/fonts/inter-variable.woff2" as="font" type="font/woff2" crossorigin>
    
    <!-- ===== FONTS ===== -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    
    <!-- ===== STYLESHEETS ===== -->
    <link rel="stylesheet" href="/src/styles/main.css">
    
    <!-- ===== SCHEMA.ORG STRUCTURED DATA ===== -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "SoftwareApplication",
        "name": "SmartFinanceAI",
        "applicationCategory": "BusinessApplication",
        "applicationSubCategory": "Personal Finance",
        "operatingSystem": "Any",
        "description": "Global Personal Finance Operating System with AI-powered coaching and multi-country support",
        "url": "https://smartfinanceai.com",
        "downloadUrl": "https://smartfinanceai.com",
        "softwareVersion": "1.0.0",
        "datePublished": "2024-01-01",
        "dateModified": "2024-01-01",
        "author": {
            "@type": "Organization",
            "name": "SmartFinanceAI",
            "url": "https://smartfinanceai.com"
        },
        "offers": {
            "@type": "Offer",
            "price": "0",
            "priceCurrency": "USD",
            "category": "Freemium"
        },
        "aggregateRating": {
            "@type": "AggregateRating",
            "ratingValue": "4.8",
            "ratingCount": "10000"
        },
        "featureList": [
            "AI Financial Coaching",
            "Multi-Currency Support", 
            "Budget Management",
            "Goal Tracking",
            "Bank Statement Import",
            "Investment Tracking",
            "Family Collaboration",
            "Advanced Analytics",
            "Security & Privacy"
        ]
    }
    </script>
    
    <!-- ===== GLOBAL CONFIGURATION ===== -->
    <script>
        // Global app configuration
        window.SmartFinanceConfig = {
            version: '1.0.0',
            environment: 'production',
            supportedCountries: ['NZ', 'AU', 'UK', 'US', 'CA'],
            defaultCountry: 'US',
            defaultCurrency: 'USD',
            defaultLocale: 'en-US',
            features: {
                aiCoaching: true,
                multiCurrency: true,
                familySharing: true,
                offlineMode: true,
                biometricAuth: true,
                darkMode: true
            },
            security: {
                encryptionEnabled: true,
                biometricSupported: !!window.PublicKeyCredential,
                webAuthnSupported: !!window.PublicKeyCredential
            },
            api: {
                baseUrl: 'https://api.smartfinanceai.com',
                version: 'v1',
                timeout: 30000
            }
        };
        
        // Detect user's country and set theme
        function detectUserCountry() {
            try {
                const timezone = Intl.DateTimeFormat().resolvedOptions().timeZone;
                const locale = navigator.language || 'en-US';
                
                // Simple country detection based on timezone and locale
                if (timezone.includes('Auckland') || timezone.includes('Wellington')) return 'NZ';
                if (timezone.includes('Sydney') || timezone.includes('Melbourne')) return 'AU';
                if (timezone.includes('London') || locale.startsWith('en-GB')) return 'UK';
                if (timezone.includes('Toronto') || timezone.includes('Vancouver') || locale.startsWith('en-CA')) return 'CA';
                
                return 'US'; // Default
            } catch (error) {
                return 'US';
            }
        }
        
        // Set country-specific theme
        function setCountryTheme() {
            const country = localStorage.getItem('userCountry') || detectUserCountry();
            const countryThemes = {
                'NZ': '#047857',
                'AU': '#d97706', 
                'UK': '#dc2626',
                'US': '#2563eb',
                'CA': '#dc2626'
            };
            
            const themeColor = countryThemes[country] || '#8b5cf6';
            document.getElementById('theme-color-meta').content = themeColor;
            document.documentElement.style.setProperty('--country-theme-color', themeColor);
            
            localStorage.setItem('userCountry', country);
            window.SmartFinanceConfig.userCountry = country;
        }
        
        // Initialize theme
        setCountryTheme();
        
        // Performance monitoring
        window.SmartFinancePerf = {
            navigationStart: performance.now(),
            marks: {},
            mark: function(name) {
                this.marks[name] = performance.now();
            }
        };
        
        window.SmartFinancePerf.mark('html-parsed');
    </script>
</head>

<body class="bg-gradient-animated min-h-screen font-primary text-white overflow-x-hidden">
    <!-- ===== LOADING SCREEN ===== -->
    <div id="loading-screen" class="fixed inset-0 z-50 flex items-center justify-center bg-gradient-primary">
        <div class="text-center">
            <!-- Logo -->
            <div class="w-20 h-20 mx-auto mb-6 bg-glass-light backdrop-blur-xl rounded-2xl flex items-center justify-center border border-glass-border-light">
                <div class="w-12 h-12 bg-gradient-primary rounded-xl flex items-center justify-center">
                    <span class="text-2xl font-bold text-white">S</span>
                </div>
            </div>
            
            <!-- Loading Animation -->
            <div class="relative">
                <div class="w-16 h-16 mx-auto mb-4">
                    <div class="absolute inset-0 border-4 border-glass-border-light rounded-full"></div>
                    <div class="absolute inset-0 border-4 border-brand-accent rounded-full border-t-transparent animate-spin"></div>
                </div>
                <h2 class="text-xl font-semibold mb-2">SmartFinanceAI</h2>
                <p class="text-sm text-gray-300">Loading your financial intelligence...</p>
            </div>
        </div>
    </div>
    
    <!-- ===== OFFLINE INDICATOR ===== -->
    <div id="offline-indicator" class="fixed top-0 left-0 right-0 z-40 bg-warning text-center py-2 px-4 transform -translate-y-full transition-transform duration-300">
        <span class="text-sm font-medium">📡 You're offline. Some features may be limited.</span>
    </div>
    
    <!-- ===== MAIN APP CONTAINER ===== -->
    <div id="app" class="min-h-screen relative">
        <!-- ===== NAVIGATION HEADER ===== -->
        <nav id="main-nav" class="navbar fixed top-0 left-0 right-0 z-30 transform -translate-y-full transition-transform duration-300">
            <div class="navbar-container">
                <!-- Brand Logo -->
                <a href="/" class="navbar-brand">
                    <div class="navbar-logo">
                        <span>S</span>
                    </div>
                    <span class="hidden sm:inline">SmartFinanceAI</span>
                </a>
                
                <!-- Desktop Navigation -->
                <ul class="navbar-nav hidden md:flex">
                    <li><a href="/dashboard" class="nav-link" data-route="dashboard">
                        <span>📊</span> Dashboard
                    </a></li>
                    <li><a href="/accounts" class="nav-link" data-route="accounts">
                        <span>🏦</span> Accounts
                    </a></li>
                    <li><a href="/budget" class="nav-link" data-route="budget">
                        <span>💰</span> Budget
                    </a></li>
                    <li><a href="/goals" class="nav-link" data-route="goals">
                        <span>🎯</span> Goals
                    </a></li>
                    <li><a href="/ai-coach" class="nav-link" data-route="ai-coach">
                        <span>🤖</span> AI Coach
                    </a></li>
                </ul>
                
                <!-- User Actions -->
                <div class="flex items-center gap-2">
                    <button id="privacy-toggle" class="btn btn-ghost btn-sm" title="Toggle Privacy Mode">
                        <span>👁️</span>
                    </button>
                    <button id="theme-toggle" class="btn btn-ghost btn-sm" title="Toggle Theme">
                        <span>🌙</span>
                    </button>
                    <button id="country-selector" class="btn btn-ghost btn-sm" title="Change Country">
                        <span id="country-flag">🇺🇸</span>
                    </button>
                    <button class="mobile-nav-toggle md:hidden">
                        <span>☰</span>
                    </button>
                </div>
            </div>
        </nav>
        
        <!-- ===== MAIN CONTENT AREA ===== -->
        <main id="main-content" class="pt-20 min-h-screen">
            <!-- Content will be dynamically loaded here -->
            <div id="route-container" class="container mx-auto px-4 py-8">
                <!-- Initial welcome screen -->
                <div id="welcome-screen" class="max-w-4xl mx-auto text-center">
                    <div class="mb-8">
                        <h1 class="text-5xl font-black mb-4 text-gradient-primary">
                            Welcome to SmartFinanceAI
                        </h1>
                        <p class="text-xl text-secondary mb-8">
                            Your Global Personal Finance Operating System
                        </p>
                        <p class="text-lg text-tertiary max-w-2xl mx-auto">
                            Transform how you manage money through intelligent automation, 
                            AI-powered coaching, and seamless multi-country support.
                        </p>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-12">
                        <div class="card glass-premium text-center p-6">
                            <div class="text-4xl mb-4">🤖</div>
                            <h3 class="text-lg font-semibold mb-2">AI Financial Coach</h3>
                            <p class="text-sm text-tertiary">Personalized insights and recommendations based on your unique financial situation.</p>
                        </div>
                        
                        <div class="card glass-premium text-center p-6">
                            <div class="text-4xl mb-4">🌍</div>
                            <h3 class="text-lg font-semibold mb-2">Global Support</h3>
                            <p class="text-sm text-tertiary">Multi-currency, multi-country banking integration with local compliance.</p>
                        </div>
                        
                        <div class="card glass-premium text-center p-6">
                            <div class="text-4xl mb-4">👥</div>
                            <h3 class="text-lg font-semibold mb-2">Family Collaboration</h3>
                            <p class="text-sm text-tertiary">Seamless money management for individuals, couples, and families.</p>
                        </div>
                    </div>
                    
                    <div class="flex flex-col sm:flex-row gap-4 justify-center">
                        <button id="get-started-btn" class="btn btn-primary btn-lg btn-glow">
                            🚀 Get Started
                        </button>
                        <button id="learn-more-btn" class="btn btn-secondary btn-lg">
                            📖 Learn More
                        </button>
                    </div>
                </div>
            </div>
        </main>
        
        <!-- ===== BOTTOM NAVIGATION (MOBILE) ===== -->
        <nav id="bottom-nav" class="fixed bottom-0 left-0 right-0 md:hidden bg-glass-medium backdrop-blur-xl border-t border-glass-border-light z-30">
            <div class="flex justify-around py-2">
                <a href="/dashboard" class="nav-link-mobile" data-route="dashboard">
                    <span class="text-xl">📊</span>
                    <span class="text-xs">Dashboard</span>
                </a>
                <a href="/budget" class="nav-link-mobile" data-route="budget">
                    <span class="text-xl">💰</span>
                    <span class="text-xs">Budget</span>
                </a>
                <a href="/goals" class="nav-link-mobile" data-route="goals">
                    <span class="text-xl">🎯</span>
                    <span class="text-xs">Goals</span>
                </a>
                <a href="/ai-coach" class="nav-link-mobile" data-route="ai-coach">
                    <span class="text-xl">🤖</span>
                    <span class="text-xs">AI Coach</span>
                </a>
                <a href="/settings" class="nav-link-mobile" data-route="settings">
                    <span class="text-xl">⚙️</span>
                    <span class="text-xs">Settings</span>
                </a>
            </div>
        </nav>
    </div>
    
    <!-- ===== ERROR BOUNDARY ===== -->
    <div id="error-boundary" class="fixed inset-0 z-50 hidden bg-danger text-white flex items-center justify-center p-4">
        <div class="card max-w-md text-center">
            <h2 class="text-xl font-bold mb-4">Oops! Something went wrong</h2>
            <p class="mb-4" id="error-message">An unexpected error occurred. Please try refreshing the page.</p>
            <div class="flex gap-2 justify-center">
                <button onclick="location.reload()" class="btn btn-primary">Refresh Page</button>
                <button id="error-report-btn" class="btn btn-secondary">Report Issue</button>
            </div>
        </div>
    </div>
    
    <!-- ===== SCRIPTS ===== -->
    <!-- Critical path scripts -->
    <script src="/src/utils/error-handler.js"></script>
    <script src="/src/utils/performance-utils.js"></script>
    <script src="/src/global/localization.js"></script>
    <script src="/src/platform/user-manager.js"></script>
    
    <!-- Core application -->
    <script type="module" src="/src/app.js"></script>
    
    <!-- Service Worker Registration -->
    <script>
        // Register service worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', async () => {
                try {
                    const registration = await navigator.serviceWorker.register('/sw.js');
                    console.log('SW registered: ', registration);
                    
                    // Update available notification
                    registration.addEventListener('updatefound', () => {
                        const newWorker = registration.installing;
                        newWorker.addEventListener('statechange', () => {
                            if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                // Show update available notification
                                showUpdateNotification();
                            }
                        });
                    });
                } catch (error) {
                    console.log('SW registration failed: ', error);
                }
            });
        }
        
        // Network status monitoring
        function updateOnlineStatus() {
            const indicator = document.getElementById('offline-indicator');
            if (navigator.onLine) {
                indicator.style.transform = 'translateY(-100%)';
            } else {
                indicator.style.transform = 'translateY(0)';
            }
        }
        
        window.addEventListener('online', updateOnlineStatus);
        window.addEventListener('offline', updateOnlineStatus);
        
        // Performance marking
        window.SmartFinancePerf.mark('scripts-loaded');
        
        // Initialize app when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeApp);
        } else {
            initializeApp();
        }
        
        function initializeApp() {
            window.SmartFinancePerf.mark('dom-ready');
            // App initialization will be handled by /src/app.js
        }
        
        function showUpdateNotification() {
            // Implementation for update notification
            console.log('App update available');
        }
    </script>
    
    <!-- Analytics (Privacy-friendly) -->
    <script>
        // Simple privacy-friendly analytics
        if (window.SmartFinanceConfig.environment === 'production') {
            // Track page view without personal data
            fetch('/api/analytics/pageview', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    url: window.location.pathname,
                    referrer: document.referrer ? new URL(document.referrer).hostname : null,
                    timestamp: Date.now(),
                    userAgent: navigator.userAgent.substring(0, 100)
                })
            }).catch(() => {}); // Fail silently
        }
    </script>
</body>
</html>