<!DOCTYPE html>
<html lang="en">
<head>
<!-- Manifest and PWA support -->
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#00bfa6" />
<link rel="apple-touch-icon" href="icons/icon-192.png">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="mobile-web-app-capable" content="yes">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Sign In - SmartFinanceAI</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="../manifest.json">
    <meta name="theme-color" content="#8b5cf6">
    
    <!-- Icons -->
    <link rel="icon" type="image/png" sizes="32x32" href="../public/icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="../public/icons/favicon-16x16.png">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        html, body {
            height: 100%;
            width: 100%;
            overflow-x: hidden;
        }
        
        body {
            background: linear-gradient(135deg, 
                #0f172a 0%, #1e1b4b 25%, #312e81 50%, #1e1b4b 75%, #0f172a 100%);
            min-height: 100vh;
            min-height: 100dvh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            position: relative;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        
        /* Animated background */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at 20% 50%, 
                rgba(139, 92, 246, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, 
                rgba(59, 130, 246, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 40% 80%, 
                rgba(16, 185, 129, 0.3) 0%, transparent 50%);
            animation: backgroundShift 20s ease-in-out infinite;
            z-index: -1;
        }
        
        @keyframes backgroundShift {
            0%, 100% { 
                transform: translateX(0) translateY(0) scale(1); 
            }
            25% { 
                transform: translateX(-20px) translateY(-10px) scale(1.05); 
            }
            50% { 
                transform: translateX(20px) translateY(10px) scale(0.95); 
            }
            75% { 
                transform: translateX(-10px) translateY(20px) scale(1.02); 
            }
        }
        
        .login-container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 2rem;
            padding: 2rem;
            width: 100%;
            max-width: 420px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            animation: slideUp 0.6s ease-out;
            position: relative;
            z-index: 1;
        }
        
        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }
        
        .login-header {
            text-align: center;
            margin-bottom: 2rem;
        }
        
        .logo-container {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #40e0d0 0%, #3b82f6 50%, #8b5cf6 100%);
            border-radius: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1.5rem;
            box-shadow: 0 12px 24px rgba(139, 92, 246, 0.4);
            animation: logoGlow 3s ease-in-out infinite;
            position: relative;
            overflow: hidden;
        }
        
        /* AI Brain Icon using SVG */
        .brain-icon {
            width: 50px;
            height: 50px;
            fill: white;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2));
        }
        
        @keyframes logoGlow {
            0%, 100% { 
                box-shadow: 0 12px 24px rgba(139, 92, 246, 0.4); 
            }
            50% { 
                box-shadow: 0 16px 32px rgba(139, 92, 246, 0.6); 
            }
        }
        
        .login-title {
            font-size: 1.75rem;
            font-weight: 700;
            color: white;
            margin-bottom: 0.5rem;
            background: linear-gradient(135deg, #40e0d0 0%, #3b82f6 50%, #8b5cf6 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .login-subtitle {
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.9rem;
            margin-bottom: 1rem;
        }
        
        .form-group {
            margin-bottom: 1.25rem;
        }
        
        .form-label {
            display: block;
            color: rgba(255, 255, 255, 0.9);
            font-weight: 600;
            margin-bottom: 0.5rem;
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .form-input {
            width: 100%;
            padding: 1rem 1.25rem;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 1rem;
            color: white;
            font-size: 1rem;
            transition: all 0.3s ease;
            box-sizing: border-box;
        }
        
        .form-input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }
        
        .form-input:focus {
            outline: none;
            border-color: #8b5cf6;
            background: rgba(255, 255, 255, 0.15);
            box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.3);
            transform: translateY(-2px);
        }
        
        .password-wrapper {
            position: relative;
        }
        
        .password-toggle {
            position: absolute;
            right: 1rem;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: rgba(255, 255, 255, 0.7);
            cursor: pointer;
            font-size: 1.25rem;
            padding: 0.25rem;
            transition: color 0.2s ease;
        }
        
        .password-toggle:hover {
            color: white;
        }
        
        .form-options {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            font-size: 0.8rem;
            flex-wrap: wrap;
            gap: 0.5rem;
        }
        
        .remember-me {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: rgba(255, 255, 255, 0.8);
        }
        
        .remember-me input[type="checkbox"] {
            width: 16px;
            height: 16px;
            accent-color: #8b5cf6;
        }
        
        .forgot-password {
            color: #8b5cf6;
            text-decoration: none;
            transition: color 0.2s ease;
            cursor: pointer;
        }
        
        .forgot-password:hover {
            color: #a855f7;
            text-decoration: underline;
        }
        
        .login-button {
            width: 100%;
            padding: 1rem;
            background: linear-gradient(135deg, #40e0d0 0%, #3b82f6 50%, #8b5cf6 100%);
            border: none;
            border-radius: 1rem;
            color: white;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 1rem;
            box-shadow: 0 8px 24px rgba(139, 92, 246, 0.4);
            position: relative;
            overflow: hidden;
        }
        
        .login-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 32px rgba(139, 92, 246, 0.6);
        }
        
        .login-button:active {
            transform: translateY(0);
        }
        
        .login-button:disabled {
            opacity: 0.7;
            cursor: not-allowed;
            transform: none;
        }
        
        .login-button.loading {
            pointer-events: none;
        }
        
        .login-button.loading::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 20px;
            height: 20px;
            margin: -10px 0 0 -10px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .divider {
            display: flex;
            align-items: center;
            margin: 1.5rem 0;
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.8rem;
        }
        
        .divider::before,
        .divider::after {
            content: '';
            flex: 1;
            height: 1px;
            background: rgba(255, 255, 255, 0.2);
        }
        
        .divider span {
            padding: 0 1rem;
        }
        
        .biometric-login {
            width: 100%;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 1rem;
            color: white;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
        }
        
        .biometric-login:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-2px);
        }
        
        .biometric-login:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .alert {
            padding: 1rem;
            border-radius: 0.75rem;
            margin-bottom: 1rem;
            font-size: 0.8rem;
            animation: slideIn 0.3s ease;
        }
        
        .alert-error {
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid rgba(239, 68, 68, 0.4);
            color: #fecaca;
        }
        
        .alert-success {
            background: rgba(16, 185, 129, 0.2);
            border: 1px solid rgba(16, 185, 129, 0.4);
            color: #a7f3d0;
        }
        
        .alert-info {
            background: rgba(59, 130, 246, 0.2);
            border: 1px solid rgba(59, 130, 246, 0.4);
            color: #bfdbfe;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .demo-section {
            margin-top: 1.5rem;
            padding: 1.25rem;
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid rgba(16, 185, 129, 0.3);
            border-radius: 1rem;
            text-align: center;
        }
        
        .demo-section h4 {
            color: #10b981;
            margin: 0 0 0.5rem 0;
            font-size: 0.9rem;
        }
        
        .demo-section p {
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.8rem;
            margin: 0 0 1rem 0;
        }
        
        .demo-button {
            background: rgba(16, 185, 129, 0.2);
            border: 1px solid rgba(16, 185, 129, 0.4);
            color: #10b981;
            padding: 0.75rem 1.5rem;
            border-radius: 0.75rem;
            font-size: 0.8rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .demo-button:hover {
            background: rgba(16, 185, 129, 0.3);
            transform: translateY(-1px);
        }
        
        .signup-link {
            text-align: center;
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.8rem;
            margin-top: 1rem;
        }
        
        .signup-link a {
            color: #8b5cf6;
            text-decoration: none;
            font-weight: 600;
            transition: color 0.2s ease;
            cursor: pointer;
        }
        
        .signup-link a:hover {
            color: #a855f7;
            text-decoration: underline;
        }
        
        /* Mobile Specific Styles */
        @media (max-width: 480px) {
            body {
                padding: 0.5rem;
            }
            
            .login-container {
                padding: 1.5rem;
                border-radius: 1.5rem;
                max-height: 95vh;
                overflow-y: auto;
            }
            
            .logo-container {
                width: 60px;
                height: 60px;
            }
            
            .brain-icon {
                width: 40px;
                height: 40px;
            }
            
            .login-title {
                font-size: 1.5rem;
            }
            
            .form-input {
                padding: 0.875rem 1rem;
                font-size: 16px; /* Prevent zoom on iOS */
            }
            
            .login-button {
                padding: 0.875rem;
            }
            
            .form-options {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.75rem;
            }
        }
    </style>
</head>
<body>
    <div class="login-container">
        <!-- Header -->
        <div class="login-header">
            <div class="logo-container">
                <!-- Custom AI Brain SVG Icon -->
                <svg class="brain-icon" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                    <!-- Outer brain shape -->
                    <path d="M25 35 C15 25, 15 15, 25 15 C35 5, 65 5, 75 15 C85 15, 85 25, 75 35 C85 45, 85 55, 75 65 C85 75, 85 85, 75 85 C65 95, 35 95, 25 85 C15 85, 15 75, 25 65 C15 55, 15 45, 25 35 Z"/>
                    
                    <!-- Inner brain divisions -->
                    <path d="M50 20 Q60 30, 50 40 Q60 50, 50 60 Q60 70, 50 80" stroke="currentColor" stroke-width="2" fill="none" opacity="0.3"/>
                    <path d="M50 20 Q40 30, 50 40 Q40 50, 50 60 Q40 70, 50 80" stroke="currentColor" stroke-width="2" fill="none" opacity="0.3"/>
                    
                    <!-- Dollar sign in center -->
                    <text x="50" y="58" text-anchor="middle" font-family="Arial, sans-serif" font-size="28" font-weight="bold" fill="white" opacity="0.9">$</text>
                    
                    <!-- Neural connections -->
                    <circle cx="35" cy="30" r="2" opacity="0.6"/>
                    <circle cx="65" cy="30" r="2" opacity="0.6"/>
                    <circle cx="30" cy="50" r="2" opacity="0.6"/>
                    <circle cx="70" cy="50" r="2" opacity="0.6"/>
                    <circle cx="35" cy="70" r="2" opacity="0.6"/>
                    <circle cx="65" cy="70" r="2" opacity="0.6"/>
                    
                    <!-- Connection lines -->
                    <line x1="35" y1="30" x2="45" y2="40" stroke="currentColor" stroke-width="1" opacity="0.4"/>
                    <line x1="65" y1="30" x2="55" y2="40" stroke="currentColor" stroke-width="1" opacity="0.4"/>
                    <line x1="30" y1="50" x2="40" y2="50" stroke="currentColor" stroke-width="1" opacity="0.4"/>
                    <line x1="70" y1="50" x2="60" y2="50" stroke="currentColor" stroke-width="1" opacity="0.4"/>
                </svg>
            </div>
            <h1 class="login-title">Welcome Back</h1>
            <p class="login-subtitle">Sign in to your SmartFinanceAI account</p>
        </div>
        
        <!-- Alert Messages -->
        <div id="alert-container"></div>
        
        <!-- Login Form -->
        <form id="login-form" novalidate>
            <div class="form-group">
                <label for="email" class="form-label">Email Address</label>
                <input 
                    type="email" 
                    id="email" 
                    name="email" 
                    class="form-input" 
                    placeholder="Enter your email"
                    required
                    autocomplete="email"
                    autofocus
                >
            </div>
            
            <div class="form-group">
                <label for="password" class="form-label">Password</label>
                <div class="password-wrapper">
                    <input 
                        type="password" 
                        id="password" 
                        name="password" 
                        class="form-input" 
                        placeholder="Enter your password"
                        required
                        autocomplete="current-password"
                        minlength="8"
                    >
                    <button type="button" class="password-toggle" id="password-toggle" tabindex="-1">
                        üëÅÔ∏è
                    </button>
                </div>
            </div>
            
            <div class="form-options">
                <label class="remember-me">
                    <input type="checkbox" id="remember-me" name="remember">
                    <span>Remember me</span>
                </label>
                
                <a href="#" class="forgot-password" id="forgot-password-link">Forgot password?</a>
            </div>
            
            <button type="submit" class="login-button" id="login-button">
                <span id="login-text">Sign In</span>
            </button>
        </form>
        
        <!-- Biometric Login -->
        <div class="divider" id="divider-section">
            <span>or</span>
        </div>
        
        <button class="biometric-login" id="biometric-login">
            <span>üîê</span>
            <span id="biometric-text">Sign in with Face ID / Fingerprint</span>
        </button>
        
        <!-- Demo Section -->
        <div class="demo-section">
            <h4>Try Demo Mode</h4>
            <p>Explore SmartFinanceAI with sample data</p>
            <button class="demo-button" id="demo-login">
                Start Demo
            </button>
        </div>
        
        <!-- Sign Up Link -->
        <div class="signup-link">
            <p>Don't have an account? <a href="#" id="register-link">Create one here</a></p>
        </div>
    </div>
    
    <script>
        /**
         * Login Page Logic - Fully Functional
         */
        class LoginPage {
            constructor() {
                this.form = document.getElementById('login-form');
                this.emailInput = document.getElementById('email');
                this.passwordInput = document.getElementById('password');
                this.rememberCheckbox = document.getElementById('remember-me');
                this.loginButton = document.getElementById('login-button');
                this.loginText = document.getElementById('login-text');
                this.biometricButton = document.getElementById('biometric-login');
                this.biometricText = document.getElementById('biometric-text');
                this.demoButton = document.getElementById('demo-login');
                this.passwordToggle = document.getElementById('password-toggle');
                this.alertContainer = document.getElementById('alert-container');
                this.dividerSection = document.getElementById('divider-section');
                this.forgotPasswordLink = document.getElementById('forgot-password-link');
                this.registerLink = document.getElementById('register-link');
                
                this.isLoading = false;
                this.biometricSupported = false;
                
                this.setupEventListeners();
                this.checkBiometricSupport();
                this.loadRememberedEmail();
                this.initializeApp();
            }
            
            initializeApp() {
                // Show welcome message
                this.showAlert('Welcome to SmartFinanceAI! üöÄ Use demo mode to explore with sample data.', 'info');
                
                // Simulate checking for existing session
                setTimeout(() => {
                    const savedSession = localStorage.getItem('smartfinance_session');
                    if (savedSession) {
                        this.showAlert('Found existing session. You can continue where you left off!', 'success');
                    }
                }, 1000);
            }
            
            setupEventListeners() {
                // Form submission
                this.form.addEventListener('submit', (e) => this.handleLogin(e));
                
                // Password toggle
                this.passwordToggle.addEventListener('click', () => this.togglePassword());
                
                // Biometric login
                this.biometricButton.addEventListener('click', () => this.handleBiometricLogin());
                
                // Demo login
                this.demoButton.addEventListener('click', () => this.handleDemoLogin());
                
                // Forgot password
                this.forgotPasswordLink.addEventListener('click', (e) => this.handleForgotPassword(e));
                
                // Register link
                this.registerLink.addEventListener('click', (e) => this.handleRegister(e));
                
                // Input validation
                this.emailInput.addEventListener('input', () => this.validateEmail());
                this.passwordInput.addEventListener('input', () => this.validatePassword());
                
                // Auto-save email for remember me
                this.emailInput.addEventListener('blur', () => this.saveEmailIfRemember());
                
                // Enter key handling
                this.passwordInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        this.handleLogin(e);
                    }
                });
            }
            
            async checkBiometricSupport() {
                try {
                    // Check if WebAuthn is supported
                    if (window.PublicKeyCredential && 
                        PublicKeyCredential.isUserVerifyingPlatformAuthenticatorAvailable) {
                        
                        const available = await PublicKeyCredential.isUserVerifyingPlatformAuthenticatorAvailable();
                        
                        if (available) {
                            this.biometricSupported = true;
                            this.biometricButton.style.display = 'flex';
                            this.dividerSection.style.display = 'flex';
                            
                            // Update button text based on platform
                            const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
                            const isMac = navigator.platform.toLowerCase().includes('mac');
                            const isAndroid = /Android/.test(navigator.userAgent);
                            
                            let biometricType = 'Biometric';
                            if (isIOS || isMac) {
                                biometricType = 'Face ID / Touch ID';
                            } else if (isAndroid) {
                                biometricType = 'Fingerprint / Face Unlock';
                            } else {
                                biometricType = 'Windows Hello';
                            }
                            
                            this.biometricText.textContent = `Sign in with ${biometricType}`;
                            
                            console.log('‚úÖ Biometric authentication available:', biometricType);
                        } else {
                            this.hideBiometricLogin();
                        }
                    } else {
                        this.hideBiometricLogin();
                    }
                } catch (error) {
                    console.log('‚ùå Biometric check failed:', error);
                    this.hideBiometricLogin();
                }
            }
            
            hideBiometricLogin() {
                this.biometricButton.style.display = 'none';
                this.dividerSection.style.display = 'none';
                console.log('‚ÑπÔ∏è Biometric authentication not available on this device');
            }
            
            async handleBiometricLogin() {
                if (!this.biometricSupported) {
                    this.showAlert('Biometric authentication is not available on this device.', 'error');
                    return;
                }
                
                try {
                    this.biometricButton.disabled = true;
                    this.biometricText.textContent = 'Authenticating...';
                    
                    // Create credential request options
                    const credentialRequestOptions = {
                        publicKey: {
                            challenge: new Uint8Array(32), // In real app, get from server
                            allowCredentials: [{
                                id: new Uint8Array(32), // Stored credential ID
                                type: 'public-key',
                                transports: ['internal']
                            }],
                            timeout: 60000,
                            userVerification: 'required'
                        }
                    };
                    
                    // Request biometric authentication
                    const credential = await navigator.credentials.get(credentialRequestOptions);
                    
                    if (credential) {
                        this.showAlert('Biometric authentication successful! üéâ', 'success');
                        
                        // Simulate successful login
                        setTimeout(() => {
                            this.redirectToDashboard('biometric');
                        }, 1500);
                    }
                } catch (error) {
                    console.log('Biometric authentication error:', error);
                    
                    if (error.name === 'NotAllowedError') {
                        this.showAlert('Biometric authentication was cancelled or failed.', 'error');
                    } else if (error.name === 'InvalidStateError') {
                        this.showAlert('Please set up biometric authentication in your device settings first.', 'info');
                    } else {
                        this.showAlert('Biometric authentication failed. Please try again.', 'error');
                    }
                } finally {
                    this.biometricButton.disabled = false;
                    this.biometricText.textContent = 'Sign in with Face ID / Fingerprint';
                }
            }
            
            handleLogin(e) {
                e.preventDefault();
                
                if (this.isLoading) return;
                
                const email = this.emailInput.value.trim();
                const password = this.passwordInput.value;
                
                // Validation
                if (!this.validateEmail() || !this.validatePassword()) {
                    this.showAlert('Please check your email and password.', 'error');
                    return;
                }
                
                this.setLoading(true);
                
                // Simulate login API call
                setTimeout(() => {
                    this.processLogin(email, password);
                }, 1500);
            }
            
            processLogin(email, password) {
                // Demo credentials for testing
                const validCredentials = [
                    { email: 'demo@smartfinanceai.com', password: 'demo123456' },
                    { email: 'test@example.com', password: 'password123' },
                    { email: 'user@test.com', password: 'smartfinance' }
                ];
                
                const isValidLogin = validCredentials.some(cred => 
                    cred.email.toLowerCase() === email.toLowerCase() && 
                    cred.password === password
                );
                
                if (isValidLogin) {
                    this.showAlert('Login successful! Welcome back! üéâ', 'success');
                    
                    // Save session
                    this.saveSession(email);
                    
                    // Save email if remember me is checked
                    if (this.rememberCheckbox.checked) {
                        localStorage.setItem('smartfinance_remember_email', email);
                    }
                    
                    // Redirect to dashboard
                    setTimeout(() => {
                        this.redirectToDashboard('password');
                    }, 1500);
                } else {
                    this.showAlert('Invalid email or password. Please try again.', 'error');
                }
                
                this.setLoading(false);
            }
            
            handleDemoLogin() {
                this.showAlert('Starting demo mode...', 'info');
                
                setTimeout(() => {
                    this.showAlert('Demo mode activated! Exploring with sample data üìä', 'success');
                    
                    // Save demo session
                    this.saveSession('demo@smartfinanceai.com', true);
                    
                    setTimeout(() => {
                        this.redirectToDashboard('demo');
                    }, 1500);
                }, 1000);
            }
            
            handleForgotPassword(e) {
                e.preventDefault();
                
                const email = this.emailInput.value.trim();
                
                if (email) {
                    this.showAlert(`Password reset instructions will be sent to ${email}`, 'info');
                    // In real app: window.location.href = '../auth/forgot-password.html';
                } else {
                    // Show password reset modal or redirect
                    this.showAlert('Please enter your email address first, then click "Forgot password?"', 'info');
                    this.emailInput.focus();
                }
            }
            
            handleRegister(e) {
                e.preventDefault();
                this.showAlert('Redirecting to registration...', 'info');
                
                setTimeout(() => {
                    // In real app: window.location.href = '../auth/register.html';
                    this.showAlert('Registration page would open here. For demo, use the demo login button instead.', 'info');
                }, 1000);
            }
            
            togglePassword() {
                const isPassword = this.passwordInput.type === 'password';
                this.passwordInput.type = isPassword ? 'text' : 'password';
                this.passwordToggle.textContent = isPassword ? 'üôà' : 'üëÅÔ∏è';
            }
            
            validateEmail() {
                const email = this.emailInput.value.trim();
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                const isValid = emailRegex.test(email);
                
                if (email && !isValid) {
                    this.emailInput.style.borderColor = '#ef4444';
                    return false;
                } else {
                    this.emailInput.style.borderColor = '';
                    return email.length > 0;
                }
            }
            
            validatePassword() {
                const password = this.passwordInput.value;
                const isValid = password.length >= 8;
                
                if (password && !isValid) {
                    this.passwordInput.style.borderColor = '#ef4444';
                    return false;
                } else {
                    this.passwordInput.style.borderColor = '';
                    return password.length > 0;
                }
            }
            
            saveEmailIfRemember() {
                if (this.rememberCheckbox.checked && this.validateEmail()) {
                    localStorage.setItem('smartfinance_remember_email', this.emailInput.value.trim());
                }
            }
            
            loadRememberedEmail() {
                const rememberedEmail = localStorage.getItem('smartfinance_remember_email');
                if (rememberedEmail) {
                    this.emailInput.value = rememberedEmail;
                    this.rememberCheckbox.checked = true;
                    this.passwordInput.focus();
                }
            }
            
            saveSession(email, isDemo = false) {
                const session = {
                    email: email,
                    loginTime: new Date().toISOString(),
                    isDemo: isDemo,
                    sessionId: this.generateSessionId()
                };
                
                localStorage.setItem('smartfinance_session', JSON.stringify(session));
                
                // Set session expiry (24 hours)
                const expiryTime = new Date();
                expiryTime.setHours(expiryTime.getHours() + 24);
                localStorage.setItem('smartfinance_session_expiry', expiryTime.toISOString());
            }
            
            generateSessionId() {
                return 'sess_' + Math.random().toString(36).substr(2, 9) + Date.now().toString(36);
            }
            
            setLoading(loading) {
                this.isLoading = loading;
                this.loginButton.disabled = loading;
                
                if (loading) {
                    this.loginButton.classList.add('loading');
                    this.loginText.textContent = '';
                } else {
                    this.loginButton.classList.remove('loading');
                    this.loginText.textContent = 'Sign In';
                }
            }
            
            showAlert(message, type = 'info') {
                // Remove existing alerts
                this.alertContainer.innerHTML = '';
                
                const alert = document.createElement('div');
                alert.className = `alert alert-${type}`;
                alert.textContent = message;
                
                this.alertContainer.appendChild(alert);
                
                // Auto-remove alerts after 5 seconds (except errors which stay longer)
                const timeout = type === 'error' ? 8000 : 5000;
                setTimeout(() => {
                    if (alert.parentNode) {
                        alert.remove();
                    }
                }, timeout);
            }
            
            redirectToDashboard(loginMethod) {
                // Create dashboard URL with login method parameter
                const dashboardUrl = `../core/dashboard.html?login=${loginMethod}&t=${Date.now()}`;
                
                // For demo purposes, show what would happen
                this.showAlert(`Redirecting to dashboard... (${loginMethod} login)`, 'success');
                
                // In a real app, you would redirect:
                // window.location.href = dashboardUrl;
                
                // For demo, simulate the redirect with a message
                setTimeout(() => {
                    this.showAlert('üéâ Login successful! In a real app, you would now be on the dashboard.', 'success');
                    
                    // Show demo next steps
                    setTimeout(() => {
                        this.showAlert('üí° Next: Create the dashboard.html file to complete the user flow.', 'info');
                    }, 3000);
                }, 2000);
            }
        }
        
        // Enhanced form interactions
        class FormEnhancements {
            constructor() {
                this.addFloatingLabels();
                this.addInputAnimations();
                this.addKeyboardShortcuts();
            }
            
            addFloatingLabels() {
                const inputs = document.querySelectorAll('.form-input');
                inputs.forEach(input => {
                    input.addEventListener('focus', () => {
                        input.parentElement.classList.add('focused');
                    });
                    
                    input.addEventListener('blur', () => {
                        if (!input.value) {
                            input.parentElement.classList.remove('focused');
                        }
                    });
                    
                    // Check if input has value on load
                    if (input.value) {
                        input.parentElement.classList.add('focused');
                    }
                });
            }
            
            addInputAnimations() {
                const inputs = document.querySelectorAll('.form-input');
                inputs.forEach(input => {
                    input.addEventListener('keydown', (e) => {
                        // Add subtle animation on key press
                        input.style.transform = 'scale(1.01)';
                        setTimeout(() => {
                            input.style.transform = '';
                        }, 100);
                    });
                });
            }
            
            addKeyboardShortcuts() {
                document.addEventListener('keydown', (e) => {
                    // Alt + D for demo login
                    if (e.altKey && e.key === 'd') {
                        e.preventDefault();
                        document.getElementById('demo-login').click();
                    }
                    
                    // Ctrl/Cmd + Enter for quick login
                    if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
                        e.preventDefault();
                        document.getElementById('login-form').dispatchEvent(new Event('submit'));
                    }
                });
            }
        }
        
        // Enhanced biometric authentication with better error handling
        class BiometricAuth {
            constructor() {
                this.credentialId = null;
                this.setupBiometric();
            }
            
            async setupBiometric() {
                try {
                    // Check for existing credentials
                    const storedCredential = localStorage.getItem('smartfinance_biometric_id');
                    if (storedCredential) {
                        this.credentialId = storedCredential;
                        console.log('‚úÖ Found existing biometric credential');
                    }
                } catch (error) {
                    console.log('Biometric setup error:', error);
                }
            }
            
            async createCredential(email) {
                try {
                    const credential = await navigator.credentials.create({
                        publicKey: {
                            challenge: new Uint8Array(32),
                            rp: {
                                name: "SmartFinanceAI",
                                id: "smartfinanceai.com",
                            },
                            user: {
                                id: new TextEncoder().encode(email),
                                name: email,
                                displayName: "SmartFinanceAI User",
                            },
                            pubKeyCredParams: [{alg: -7, type: "public-key"}],
                            authenticatorSelection: {
                                authenticatorAttachment: "platform",
                                userVerification: "required"
                            },
                            timeout: 60000,
                            attestation: "direct"
                        }
                    });
                    
                    if (credential) {
                        // Store credential ID
                        this.credentialId = credential.id;
                        localStorage.setItem('smartfinance_biometric_id', credential.id);
                        return true;
                    }
                } catch (error) {
                    console.log('Credential creation error:', error);
                    return false;
                }
            }
        }
        
        // Performance monitoring
        class PerformanceMonitor {
            constructor() {
                this.startTime = performance.now();
                this.monitorPageLoad();
            }
            
            monitorPageLoad() {
                window.addEventListener('load', () => {
                    const loadTime = performance.now() - this.startTime;
                    console.log(`üìä Page loaded in ${loadTime.toFixed(2)}ms`);
                    
                    // Track page load performance
                    if (loadTime > 2000) {
                        console.warn('‚ö†Ô∏è Slow page load detected');
                    }
                });
            }
        }
        
        // Initialize everything when DOM is ready
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ SmartFinanceAI Login Page Initializing...');
            
            // Initialize main login functionality
            const loginPage = new LoginPage();
            
            // Initialize enhancements
            const formEnhancements = new FormEnhancements();
            const biometricAuth = new BiometricAuth();
            const performanceMonitor = new PerformanceMonitor();
            
            // Set up service worker for PWA functionality
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('../sw.js')
                    .then(registration => {
                        console.log('‚úÖ Service Worker registered:', registration);
                    })
                    .catch(error => {
                        console.log('‚ùå Service Worker registration failed:', error);
                    });
            }
            
            // Check for PWA install prompt
            let deferredPrompt;
            window.addEventListener('beforeinstallprompt', (e) => {
                e.preventDefault();
                deferredPrompt = e;
                console.log('üí° PWA install available');
            });
            
            console.log('‚úÖ SmartFinanceAI Login Page Ready!');
            console.log('üí° Demo credentials:');
            console.log('   üìß Email: demo@smartfinanceai.com');
            console.log('   üîë Password: demo123456');
            console.log('   üéÆ Or use the "Start Demo" button');
        });
        
        // Add error boundary for better error handling
        window.addEventListener('error', function(e) {
            console.error('üí• JavaScript Error:', e.error);
            
            // Show user-friendly error message
            const alertContainer = document.getElementById('alert-container');
            if (alertContainer) {
                alertContainer.innerHTML = `
                    <div class="alert alert-error">
                        Something went wrong. Please refresh the page and try again.
                    </div>
                `;
            }
        });
        
        // Handle offline/online status
        window.addEventListener('online', () => {
            console.log('üåê Connection restored');
            const alertContainer = document.getElementById('alert-container');
            if (alertContainer) {
                alertContainer.innerHTML = `
                    <div class="alert alert-success">
                        Connection restored! You're back online.
                    </div>
                `;
            }
        });
        
        window.addEventListener('offline', () => {
            console.log('üì¥ Connection lost');
            const alertContainer = document.getElementById('alert-container');
            if (alertContainer) {
                alertContainer.innerHTML = `
                    <div class="alert alert-info">
                        You're offline. Some features may be limited.
                    </div>
                `;
            }
        });
    </script>
</body>
</html>