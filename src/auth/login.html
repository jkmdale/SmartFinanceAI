<!DOCTYPE html>
<html lang="en">
<head>
<script src="https://cdn.jsdelivr.net/npm/@github/webauthn-json@2.1.1/dist/esm/webauthn-json.browser.ponyfill.js"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SmartFinanceAI - Working Login</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#00bfa6" />
    <link rel="apple-touch-icon" href="icons/apple-touch-icon.png">
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            background: linear-gradient(135deg, #0f172a 0%, #1e1b4b 25%, #312e81 50%, #1e1b4b 75%, #0f172a 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        
        .login-container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 2rem;
            padding: 2rem;
            width: 100%;
            max-width: 420px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }
        
        .logo-container {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #00bfa6 0%, #3b82f6 50%, #8b5cf6 100%);
            border-radius: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1.5rem;
            box-shadow: 0 12px 24px rgba(0, 191, 166, 0.4);
        }
        
        .brain-icon {
            width: 50px;
            height: 50px;
            fill: white;
            border-radius: 8px;
        }
        
        .brain-icon[src] {
            /* Styles for actual image */
            object-fit: contain;
        }
        
        .login-title {
            font-size: 1.75rem;
            font-weight: 700;
            color: white;
            margin-bottom: 0.5rem;
            text-align: center;
            background: linear-gradient(135deg, #00bfa6 0%, #3b82f6 50%, #8b5cf6 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .login-subtitle {
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.9rem;
            margin-bottom: 2rem;
            text-align: center;
        }
        
        .form-group {
            margin-bottom: 1.25rem;
        }
        
        .form-label {
            display: block;
            color: rgba(255, 255, 255, 0.9);
            font-weight: 600;
            margin-bottom: 0.5rem;
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .form-input {
            width: 100%;
            padding: 1rem 1.25rem;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 1rem;
            color: white;
            font-size: 1rem;
            transition: all 0.3s ease;
        }
        
        .form-input::placeholder { color: rgba(255, 255, 255, 0.5); }
        
        .form-input:focus {
            outline: none;
            border-color: #00bfa6;
            background: rgba(255, 255, 255, 0.15);
            box-shadow: 0 0 0 3px rgba(0, 191, 166, 0.3);
        }
        
        .form-input.error {
            border-color: #ef4444;
            box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.3);
        }
        
        .login-button {
            width: 100%;
            padding: 1rem;
            background: linear-gradient(135deg, #00bfa6 0%, #3b82f6 50%, #8b5cf6 100%);
            border: none;
            border-radius: 1rem;
            color: white;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 1.5rem 0;
            position: relative;
        }
        
        .login-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 32px rgba(0, 191, 166, 0.6);
        }
        
        .login-button:disabled { opacity: 0.7; cursor: not-allowed; }
        
        .login-button.loading::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 20px;
            height: 20px;
            margin: -10px 0 0 -10px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin { to { transform: rotate(360deg); } }
        
        .alert {
            padding: 1rem;
            border-radius: 0.75rem;
            margin-bottom: 1rem;
            font-size: 0.85rem;
        }
        
        .alert-error {
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid rgba(239, 68, 68, 0.4);
            color: #fecaca;
        }
        
        .alert-success {
            background: rgba(16, 185, 129, 0.2);
            border: 1px solid rgba(16, 185, 129, 0.4);
            color: #a7f3d0;
        }
        
        .alert-info {
            background: rgba(59, 130, 246, 0.2);
            border: 1px solid rgba(59, 130, 246, 0.4);
            color: #bfdbfe;
        }
        
        .demo-accounts {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 1rem;
            padding: 1rem;
            margin-bottom: 1rem;
        }
        
        .demo-accounts h4 {
            color: #00bfa6;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
        }
        
        .demo-account {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 0.5rem;
            padding: 0.75rem;
            margin: 0.5rem 0;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.8rem;
        }
        
        .demo-account:hover {
            background: rgba(255, 255, 255, 0.15);
        }
        
        .demo-account strong {
            color: #00bfa6;
            display: block;
        }
        
        .demo-account span {
            color: rgba(255, 255, 255, 0.7);
        }
        
        .signup-link {
            text-align: center;
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.8rem;
            margin-top: 1rem;
        }
        
        .signup-link a {
            color: #00bfa6;
            text-decoration: none;
            font-weight: 600;
        }
        
        @media (max-width: 480px) {
            .login-container { padding: 1.5rem; }
            .form-input { font-size: 16px; }
        }
    </style>
</head>
<body>
    <div class="login-container">
        <div class="logo-container">
            <img src="icons/icon-192.png" alt="SmartFinanceAI Logo" class="brain-icon" 
                 onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
            <!-- Fallback SVG if icon doesn't load -->
            <svg class="brain-icon" viewBox="0 0 100 100" style="display: none;">
                <path d="M25 35 C15 25, 15 15, 25 15 C35 5, 65 5, 75 15 C85 15, 85 25, 75 35 C85 45, 85 55, 75 65 C85 75, 85 85, 75 85 C65 95, 35 95, 25 85 C15 85, 15 75, 25 65 C15 55, 15 45, 25 35 Z"/>
                <text x="50" y="58" text-anchor="middle" font-family="Arial" font-size="28" font-weight="bold" fill="white">$</text>
            </svg>
        </div>
        
        <h1 class="login-title">Welcome Back</h1>
        <p class="login-subtitle">Sign in to your SmartFinanceAI account</p>
        
        <div id="alert-container"></div>
        
        <!-- Demo Accounts for Testing -->
        <div class="demo-accounts">
            <h4>ðŸ”¹ Test Accounts (Click to use):</h4>
            <div class="demo-account" onclick="fillLogin('admin@smartfinanceai.com', 'admin123')">
                <strong>Admin Account</strong>
                <span>admin@smartfinanceai.com / admin123</span>
            </div>
            <div class="demo-account" onclick="fillLogin('user@smartfinanceai.com', 'user123')">
                <strong>User Account</strong>
                <span>user@smartfinanceai.com / user123</span>
            </div>
        </div>
        
        <form id="login-form">
            <div class="form-group">
                <label for="email" class="form-label">Email Address</label>
                <input 
                    type="email" 
                    id="email" 
                    class="form-input" 
                    placeholder="Enter your email"
                    required
                >
            </div>
            
            <div class="form-group">
                <label for="password" class="form-label">Password</label>
                <input 
                    type="password" 
                    id="password" 
                    class="form-input" 
                    placeholder="Enter your password"
                    required
                    minlength="6"
                >
            </div>
            
            <button type="submit" class="login-button" id="login-button">
                <span id="login-text">Sign In</span>
            </button>
        </form>
        
        <div class="signup-link">
            <p>Don't have an account? <a href="#" onclick="showRegisterForm()">Create one here</a></p>
        </div>
    </div>
    
    <script>
        /**
         * ACTUALLY WORKING LOGIN SYSTEM
         * Uses localStorage to simulate a real backend
         */
        
        // Simulated user database
        const USERS = {
            'admin@smartfinanceai.com': {
                password: 'admin123',
                name: 'Admin User',
                role: 'admin',
                id: '1'
            },
            'user@smartfinanceai.com': {
                password: 'user123',
                name: 'John Doe',
                role: 'user',
                id: '2'
            }
        };
        
        class WorkingLogin {
            constructor() {
                this.form = document.getElementById('login-form');
                this.emailInput = document.getElementById('email');
                this.passwordInput = document.getElementById('password');
                this.loginButton = document.getElementById('login-button');
                this.loginText = document.getElementById('login-text');
                this.alertContainer = document.getElementById('alert-container');
                
                this.initializeEventListeners();
                this.checkExistingSession();
            }
            
            initializeEventListeners() {
                this.form.addEventListener('submit', (e) => this.handleLogin(e));
                
                // Clear errors on input
                this.emailInput.addEventListener('input', () => this.clearErrors());
                this.passwordInput.addEventListener('input', () => this.clearErrors());
            }
            
            checkExistingSession() {
                const user = localStorage.getItem('currentUser');
                if (user) {
                    this.showAlert('You are already signed in! Redirecting...', 'success');
                    setTimeout(() => {
                        this.redirectToDashboard();
                    }, 1500);
                }
            }
            
            async handleLogin(e) {
                e.preventDefault();
                
                const email = this.emailInput.value.trim();
                const password = this.passwordInput.value;
                
                // Validation
                if (!this.validateForm(email, password)) {
                    return;
                }
                
                this.setLoading(true);
                
                // Simulate API delay
                await this.delay(1500);
                
                // Check credentials
                const user = USERS[email];
                
                if (user && user.password === password) {
                    // Success!
                    this.handleSuccessfulLogin(user, email);
                } else {
                    // Failed
                    this.handleLoginError('Invalid email or password');
                }
                
                this.setLoading(false);
            }
            
            handleSuccessfulLogin(user, email) {
                // Store user session
                const sessionData = {
                    email: email,
                    name: user.name,
                    role: user.role,
                    id: user.id,
                    loginTime: new Date().toISOString()
                };
                
                localStorage.setItem('currentUser', JSON.stringify(sessionData));
                localStorage.setItem('authToken', 'fake-jwt-token-' + user.id);
                
                this.showAlert(`Welcome back, ${user.name}! Redirecting to dashboard...`, 'success');
                
                // Clear form
                this.form.reset();
                
                // Redirect after delay
                setTimeout(() => {
                    this.redirectToDashboard();
                }, 2000);
            }
            
            handleLoginError(message) {
                this.showAlert(message, 'error');
                this.emailInput.classList.add('error');
                this.passwordInput.classList.add('error');
                this.emailInput.focus();
            }
            
            validateForm(email, password) {
                if (!email) {
                    this.showAlert('Email is required', 'error');
                    this.emailInput.focus();
                    return false;
                }
                
                if (!this.isValidEmail(email)) {
                    this.showAlert('Please enter a valid email address', 'error');
                    this.emailInput.focus();
                    return false;
                }
                
                if (!password) {
                    this.showAlert('Password is required', 'error');
                    this.passwordInput.focus();
                    return false;
                }
                
                if (password.length < 6) {
                    this.showAlert('Password must be at least 6 characters', 'error');
                    this.passwordInput.focus();
                    return false;
                }
                
                return true;
            }
            
            isValidEmail(email) {
                return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
            }
            
            setLoading(loading) {
                if (loading) {
                    this.loginButton.classList.add('loading');
                    this.loginButton.disabled = true;
                    this.loginText.textContent = '';
                } else {
                    this.loginButton.classList.remove('loading');
                    this.loginButton.disabled = false;
                    this.loginText.textContent = 'Sign In';
                }
            }
            
            showAlert(message, type = 'info') {
                this.alertContainer.innerHTML = '';
                
                const alert = document.createElement('div');
                alert.className = `alert alert-${type}`;
                alert.textContent = message;
                
                this.alertContainer.appendChild(alert);
                
                if (type !== 'error') {
                    setTimeout(() => {
                        if (alert.parentNode) {
                            alert.remove();
                        }
                    }, 5000);
                }
            }
            
            clearErrors() {
                this.emailInput.classList.remove('error');
                this.passwordInput.classList.remove('error');
            }
            
            redirectToDashboard() {
                // Check if dashboard.html exists, otherwise show success page
                window.location.href = 'dashboard.html';
                
                // Fallback: create a simple success page
                setTimeout(() => {
                    if (window.location.href === window.location.href) {
                        this.showSuccessPage();
                    }
                }, 100);
            }
            
            showSuccessPage() {
                document.body.innerHTML = `
                    <div style="
                        background: linear-gradient(135deg, #0f172a 0%, #1e1b4b 25%, #312e81 50%, #1e1b4b 75%, #0f172a 100%);
                        min-height: 100vh;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
                        color: white;
                        text-align: center;
                        padding: 2rem;
                    ">
                        <div style="
                            background: rgba(255, 255, 255, 0.1);
                            backdrop-filter: blur(20px);
                            border-radius: 2rem;
                            padding: 3rem;
                            max-width: 500px;
                        ">
                            <div style="font-size: 4rem; margin-bottom: 1rem;">ðŸŽ‰</div>
                            <h1 style="color: #00bfa6; margin-bottom: 1rem;">Login Successful!</h1>
                            <p style="margin-bottom: 2rem; opacity: 0.8;">You have successfully signed in to SmartFinanceAI</p>
                            <button onclick="window.location.reload()" style="
                                background: linear-gradient(135deg, #00bfa6 0%, #3b82f6 50%, #8b5cf6 100%);
                                border: none;
                                padding: 1rem 2rem;
                                border-radius: 1rem;
                                color: white;
                                font-weight: 600;
                                cursor: pointer;
                            ">Back to Login</button>
                            <div style="margin-top: 2rem; padding: 1rem; background: rgba(255,255,255,0.05); border-radius: 1rem;">
                                <h3 style="color: #00bfa6; margin-bottom: 0.5rem;">Next Steps:</h3>
                                <p style="font-size: 0.9rem; opacity: 0.8;">
                                    Create a dashboard.html page or integrate with your backend API
                                </p>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            delay(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }
        }
        
        // Helper function for demo accounts
        function fillLogin(email, password) {
            document.getElementById('email').value = email;
            document.getElementById('password').value = password;
        }
        
        function showRegisterForm() {
            alert('Registration form would be implemented in register.html');
        }
        
        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', () => {
            new WorkingLogin();
        });
        
        // Service Worker Registration
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/service-worker.js')
                .catch(err => console.log('Service Worker registration failed'));
        }
    </script>
</body>
</html>